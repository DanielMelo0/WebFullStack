<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Sistema de Gerenciamento Médico</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.6.3/css/all.css"
      integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/"
      crossorigin="anonymous"
    />
  </head>
<nav class="navbar navbar-expand-lg navbar-light bg-light">
  <a class="navbar-brand" href="#"><span style="color:aqua; font-weight: bold;">NautaSoft</span></a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav mr-auto">
      <li class="nav-item active">
        <a class="nav-link" href="./cliente.html">Paciente <span class="sr-only">(current)</span></a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="./procedimentos.html">Procedimentos</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="./profissionais.html">Profissionais</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="index.html">Laudos</a>
      </li>

  
    </ul>
  
  </div>
</nav>

    <!-- Main Container Init-->
    <div class="container">
      <h1 class="m-4 text-center items-center text-primary">Sistema de Gerenciamento Médico</h1>
      <h2 class="text-center text-primary">Profissionais</h2>

        <!-- Save User Init -->
        <form id="formCadastroProfissionais">            
              
    
    <!-- ID Cliente -->
    <div class="mb-3">
      <label for="id_profissional" class="form-label">ID Profissional</label>
      <input type="number" class="form-control" id="id_cliente" readonly placeholder="ID automático" />
    </div>

    <!-- Nome do Profissional -->
    <div class="mb-3">
      <label for="nome_profissional" class="form-label">Nome do Profissional</label>
      <input
        type="text"
        class="form-control"
        id="nome_profissional"
        required
        placeholder="Informe o nome do Profissional"
      />
    </div>

    <!-- Documento CRM  -->
    <div class="mb-3">
      <label for="Sigla" class="form-label">Documento</label>
      <input
        type="text"
        class="form-control"
        id="sigla"
        required
        placeholder="Informe o Documento CRM do Profissional"
      />
    </div>
    
    <!-- Titulo  -->
     <div class="mb-3">
      <label for="" class="form-label">Titulo Profissional</label>
      <input
        type="text"
        class="form-control"
        id="sigla"
        required
        placeholder="Titulo do Profissional"
      />
     </div>


    <!-- Assinatura -->
     <div class="mb-3">
      <label for="" class="form-label">Assinatura </label>
      <input
        type="text"
        class="form-control"
        id="avulso"
        required
        placeholder="Assinatura do Profissional"
      />
     </div>





    <!-- Botões -->
 
      <!-- Botão Salvar -->
      <button
        type="submit"
        id="btnTeste"
    
        class="btn btn-primary"
      >
        Salvar
      </button>

      <!-- Botão Novo -->
      <button 
        type="button" 
        onClick="" 
        class="btn btn-danger"
      >
        Novo
      </button>

      <!-- Botão Buscar -->
      <button
        type="button"
        class="btn btn-success"
        data-bs-toggle="modal"
        data-bs-target="#modalPesquisarLaudos"
      >
        Buscar
      </button>

      <!-- Botão Listar -->
      <button
        id="listarProfissionais"
        type="button"
        class="btn btn-info"
      >
        Listar Profissionais
      </button>


</form>

</form>
      <div class="container mt-5">
    <h2 class="mb-4">Lista de Profissionais</h2>

    <table class="table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>Documento</th>
                <th>Titulo</th>
                <th>Assinatura</th>                
            </tr>
        </thead>

        <tbody id="">
            <!-- lListar Usuarios-->
        </tbody>
    </table>
</div>

    <div class="modal fade" id="modalPesquisarLaudos" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header text-center">
                    <h1 class="center modal-title fs-5" id="exampleModalLabel">Busca de Profissionais</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form id="formBuscar">
    <div class="mb-3">
        <label for="nomeBusca" class="col-form-label">Informe o Nome do Profissional</label>
        <input type="text" class="form-control" id="nomeBusca" placeholder="Digite o nome do Profissional">
    </div>
    <button type="button" class="btn btn-success" id="btFindUser";">Buscar</button>
</form>
    <table class=" mt-4 table">
        <thead>
            <tr>
                <th>ID</th>
                <th>Nome</th>
                <th>CPF</th>
                <th>Email</th>
                <th>Nascimento</th>
                <th>Celular</th>            
                <th scope="col">Editar</th>
                <th scope="col">Remover</th>
            </tr>
        </thead>

        <tbody id="resultadoBusca">
            <!-- lListar Usuarios-->
        </tbody>
    </table>
                    

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                </div>
            </div>
        </div>
    </div>

    </div> <!-- Main Container -->
    <!-- JQuery Script -->
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
    <!-- Bootstrap Script -->
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>

    <!-- Main Script -->
    <script src="./assets/js/main.js"></script>
    <!-- SweetAlert Script-->
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

     <!-- Jquer Ajax-->
<script>
$(document).ready(function() {

    // ✅ Enviar dados do formulário
    $("#formCadastro").on('submit', function(e) {
        e.preventDefault();

        $.ajax({
            url: 'api/inserirCliente.php',
            type: 'POST',
            data: $(this).serialize(),
            dataType: 'json',
            success: function(response) {
              console.log(":)")
                if (response.status === 'success') {
                    $("#resultado").html(`<div class="alert alert-success">${response.message}</div>`);
                    $("#formCadastro")[0].reset();
                    listarUsuarios(); // Atualiza a tabela após inserir
                } else {
                    $("#resultado").html(`<div class="alert alert-danger">${response.message}</div>`);
                }
            },
            error: function(xhr, status, error) {
                console.error('Erro:', error);
                $("#resultado").html(`<div class="alert alert-danger">Erro na requisição.</div>`);
            }
        });
    });

    // ✅ Função para listar usuários
    function listarUsuarios() {
        $.ajax({
            url: 'api/listarUsuarios.php',
            type: 'GET',
            dataType: 'json',
            success: function(data) {
                const $tabela = $("#tabelaUsuarios");
                $tabela.empty();

                if (Array.isArray(data) && data.length > 0) {
                    data.forEach(usuario => {
                        $tabela.append(`
                            <tr>
                                <td>${usuario.id}</td>
                                <td>${usuario.nome_cliente}</td>
                                <td>${usuario.cpf}</td>
                                <td>${usuario.email}</td>
                                <td>${usuario.data_nasc}</td>
                                <td>${usuario.numero_celular}</td>
                            </tr>
                        `);
                    });
                } else {
                    $tabela.append(`<tr><td colspan="6" class="text-center">Nenhum usuário encontrado</td></tr>`);
                }
            },
            error: function(xhr, status, error) {
                console.error("Erro na requisição:", status, error);
                alert("Erro ao carregar os usuários.");
            }
        });
    }

    // ✅ Carrega a lista de usuários quando a página abrir
    listarUsuarios();

    // ✅ Opcional: carregar lista quando clicar em botão "Listar Pacientes"
    $("#listarPacientes").on('click', function() {
        listarUsuarios();
    });

    // Evento para botão Remover dentro da tabela
$(document).on('click', '.btnRemover', function() {
    const id = $(this).data('id');

    Swal.fire({
        title: 'Tem certeza?',
        text: "Essa ação não poderá ser desfeita!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Sim, deletar!',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: 'api/deletarCliente.php',
                type: 'POST',
                data: { id: id },
                dataType: 'json',
                success: function(response) {
                    if (response.status === 'success') {
                        Swal.fire('Deletado!', response.message, 'success');
                        listarUsuarios(); // Atualiza a tabela
                    } else {
                        Swal.fire('Erro!', response.message, 'error');
                    }
                },
                error: function() {
                    Swal.fire('Erro!', 'Erro na requisição.', 'error');
                }
            });
        }
    });
});

 /*('#Exe').on('click', function() {
        // Ação que será executada no clique
        alert('Botão clicado!');
        
        // Ou exemplo com console:
        console.log('Executando ação do botão #Exe');

        // Aqui você pode fazer qualquer ação, como AJAX, animações, etc.
    });
/*function deletarCliente(id) {
    Swal.fire({
        title: 'Tem certeza?',
        text: "Essa ação não pode ser desfeita!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#d33',
        cancelButtonColor: '#3085d6',
        confirmButtonText: 'Sim, deletar!',
        cancelButtonText: 'Cancelar'
    }).then((result) => {
        if (result.isConfirmed) {
            $.ajax({
                url: 'deletarCliente.php',
                type: 'GET',
                data: { id: id },
                success: function(response) {
                    if (response.success) {
                        Swal.fire(
                            'Deletado!',
                            response.message,
                            'success'
                        );
                        // Atualiza a tabela após deletar
                        carregarClientes();
                    } else {
                        Swal.fire(
                            'Erro!',
                            response.error,
                            'error'
                        );
                    }
                },
                error: function() {
                    Swal.fire(
                        'Erro!',
                        'Ocorreu um erro na solicitação.',
                        'error'
                    );
                }
            });
        }
    });
}*/

  $("#btnTeste").on('click', function() {
    const id = $("#id_cliente").val();

    const dados = {
        id: id, // Pode ser vazio ou preenchido (editar)
        nome_cliente: $("#nome_cliente").val(),
        cpf: $("#cpf").val(),
        email: $("#email").val(),
        data_nasc: $("#data_nasc").val(),
        numero_celular: $("#numero_celular").val()
    };

    // Validação simples
    if (dados.nome_cliente.trim() === "" || dados.cpf.trim() === "" || dados.email.trim() === "") {
        Swal.fire('Atenção!', 'Preencha todos os campos obrigatórios.', 'warning');
        return;
    }

    $.ajax({
        url: 'api/inserirCliente.php', // Pode ser usado tanto para inserir quanto para editar
        type: 'POST',
        data: dados,
        dataType: 'json',
        success: function(response) {
            if (response.status === 'success') {
                Swal.fire('Sucesso!', response.message, 'success');
                $("#formCadastroPaciente")[0].reset();
                listarUsuarios();
            } else {
                Swal.fire('Erro!', response.message, 'error');
            }
        },
        error: function() {
            Swal.fire('Erro!', 'Erro na requisição.', 'error');
        }
    });
});

// Save User
  /*$("#btnTeste").on('click', function() {
    console.log(":)")
   const dados = {
        nome_cliente: $("#nome_cliente").val(),
        cpf: $("#cpf").val(),
        email: $("#email").val(),
        data_nasc: $("#data_nasc").val(),
        numero_celular: $("#numero_celular").val()
    };

    $.ajax({
        url: 'api/inserirCliente.php',
        type: 'POST',
        data: dados,
        dataType: 'json',
        success: function(response) {
            if (response.status === 'success') {
                Swal.fire('Sucesso!', response.message, 'success');
                $("#formCadastroPaciente")[0].reset();
                listarUsuarios();
            } else {
                Swal.fire('Erro!', response.message, 'error');
            }
        },
        error: function() {
            Swal.fire('Erro!', 'Erro na requisição.', 'error');
        }
    });
  });*/

  }); // Sace User



  $("#btFindUser").on('click', function() {
    const nomeBusca = $("#nomeBusca").val();

    if (nomeBusca.trim() === "") {
        Swal.fire('Atenção', 'Informe um nome para buscar.', 'warning');
        return;
    }

    $.ajax({
        url: 'api/buscarCliente.php',
        type: 'GET',
        data: { nome: nomeBusca },
        dataType: 'json',
        success: function(data) {
            const $resultado = $("#resultadoBusca");
            $resultado.empty();

            if (Array.isArray(data) && data.length > 0) {
                data.forEach(cliente => {
                    $resultado.append(`
                        <tr>
                            <td>${cliente.id}</td>
                            <td>${cliente.nome_cliente}</td>
                            <td>${cliente.cpf}</td>
                            <td>${cliente.email}</td>
                            <td>${cliente.data_nasc}</td>
                            <td>${cliente.numero_celular}</td>
                                    <td>
            <button class="btn btn-success btnEditar"
                data-id="${cliente.id}"
                data-nome="${cliente.nome_cliente}"
                data-cpf="${cliente.cpf}"
                data-email="${cliente.email}"
                data-nasc="${cliente.data_nasc}"
                data-celular="${cliente.numero_celular}">
                Editar
            </button>
        </td>      
                            <td><button class="btn btn-danger btnRemover" data-id="${cliente.id}">Remover</button></td>
                        </tr>
                    `);
                });
            } else {
                $resultado.append('<tr><td colspan="6" class="text-center">Nenhum paciente encontrado</td></tr>');
            }
        },
        error: function() {
            Swal.fire('Erro', 'Erro ao buscar paciente.', 'error');
        }
    });
});

// Evento Editar
$(document).on('click', '.btnEditar', function() {
    const id = $(this).data('id');
    const nome = $(this).data('nome');
    const cpf = $(this).data('cpf');
    const email = $(this).data('email');
    const nasc = $(this).data('nasc');
    const celular = $(this).data('celular');

    // Preenche os campos do formulário
    $("#id_cliente").val(id);
    $("#nome_cliente").val(nome);
    $("#cpf").val(cpf);
    $("#email").val(email);
    $("#data_nasc").val(nasc);
    $("#numero_celular").val(celular);

    // Fecha o modal de busca (se desejar)
    $('#modalPesquisarLaudos').modal('hide');
});

function novoPaciente() {
    $("#formCadastroPaciente")[0].reset();
    $("#id_cliente").val(""); // Limpa o ID para novo cadastro
}


</script>


  </body>
</html>
